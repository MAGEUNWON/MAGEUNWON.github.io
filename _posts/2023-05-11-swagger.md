---
layout: post
title: Swagger
tags: [node.js, api]
categories:
  - Node.js
date: 2023-05-11
---

# Swagger

## Swaggerë€?

Swaggerë€ ê°œë°œí•œ Rest APIë¥¼ í¸ë¦¬í•˜ê²Œ ë¬¸ì„œí™” í•´ì£¼ê³ , ì´ë¥¼ í†µí•´ì„œ ê´€ë¦¬ ë° ì œ 3ì˜ ì‚¬ìš©ìê°€ í¸ë¦¬í•˜ê²Œ APIë¥¼ í˜¸ì¶œí•´ë³´ê³  í…ŒìŠ¤íŠ¸ í•  ìˆ˜ ìˆëŠ” í”„ë¡œì íŠ¸ì„.

ëŒ€ë¶€ë¶„ì˜ ì´ìš©ìë“¤ì€ Swagger UI ë„êµ¬ë¥¼ í†µí•´ Swaggerë¥¼ ì‹ë³„í•˜ë©°, Swagger Tool Setì—ëŠ” ìë™í™”ëœ ë¬¸ì„œí™”, Code ìƒì„±, Test Case ìƒì„± ì§€ì›ì´ í¬í•¨ë¨

ì¦‰, Swaggerë¥¼ ì´ìš©í•˜ê²Œë˜ë©´ API ë¬¸ì„œë¥¼ ê°œë°œìê°€ ë”°ë¡œ ì‘ì„±í•  í•„ìš” ì—†ì´ Codeë§Œ ì‘ì„±í•´ ì£¼ë©´ ì•Œì•„ì„œ Web Pageë¥¼ ë§Œë“¤ì–´ ë¬¸ì„œë¥¼ ë³´ì—¬ì£¼ê²Œ ë¨.

ë°±ì—ì„œ API ì œì‘ì´ ëë‚œ í›„ì— í”„ë¡ íŠ¸ì— ì „ë‹¬í•  ë•Œ github Wiki, íŒŒì¼, ì—‘ì…€, notion ë“±ìœ¼ë¡œ ë„˜ê²¨ë„ ë˜ì§€ë§Œ ìˆ˜ê¸°ë¡œ ì‘ì„±í•´ì•¼ í•¨. APIëŠ” ì •í•´ì§„ ê·œì¹™ì´ ìˆê¸° ë•Œë¬¸ì— ì¡°ê¸ˆë§Œ ì˜¤íƒˆìê°€ ë°œìƒí•´ë„ ì˜í–¥ì„ ì¤Œ.

ì´ëŸ¬í•œ ë¬¸ì œë¥¼ í•´ê²°í•˜ê¸° ìœ„í•´ ì“¸ ìˆ˜ ìˆëŠ” ê²ƒì´ swaggerì„.

## Node.js ì—ì„œ Swagger ì‚¬ìš©í•˜ê¸°

âœ… npm module ì„¤ì¹˜

```
npm i swagger-ui-express swagger-autogen --save-dev
```

swaggerëŠ” ê°œë°œìš© ëª¨ë“ˆì´ë¯€ë¡œ devì— ì„¤ì¹˜í•¨

autogen ì•ˆì“°ë©´ apiê°€ í•˜ë‚˜ ì¶”ê°€ë ë•Œ ë§ˆë‹¤ í•˜ë‚˜í•˜ë‚˜ ì£¼ì„ ì‘ì„±ì„ í•´ì¤˜ì•¼ í•˜ê¸° ë•Œë¬¸ì— ë²ˆê±°ë¡œì›€.

autogenì€ router ìœ„ì¹˜í•œ íŒŒì¼ ê²½ë¡œë¥¼ ì•Œë ¤ì£¼ë©´ ìë™ìœ¼ë¡œ í•´ë‹¹ routerë¥¼ ì¸ì‹í•˜ê³  ê·¸ ë°‘ì— ìˆëŠ” routerë“¤ë„ ì¸ì‹í•˜ì—¬ api ë¬¸ì„œë¥¼ ìœ„í•œ jsoníŒŒì¼ì„ ìë™ìœ¼ë¡œ ìƒì„±í•´ ì£¼ëŠ” ë¼ì´ë¸ŒëŸ¬ë¦¬ì„.

âœ… Swagger.js íŒŒì¼ ë§Œë“¤ê¸°

root í´ë”ì— ë§Œë“¤ì–´ ì¤Œ

```
// swagger.js

const swaggerAutogen = require('swagger-autogen')();

const doc = {
    info: {
      title: "Swagger API",
      description: "Swagger API",
    },
    host: "http://localhost:8080",
    schemes: ["http"],
  securityDefinitions: {
    bearerAuth: {
        name: "Authorization",
        in: "header",
        type: "apiKey",
        description: "JWT Authorization header"
    }
  },
  security: [ { bearerAuth: [] } ],
};

const outputFile = "./swagger-output.json";
const endpointsFiles = [
    "./server.js"
];

swaggerAutogen(outputFile, endpointsFiles, doc)
```

security ëŠ” JWTë¥¼ ìœ„í•œ ì„¤ì •

pagkage.json scriptsì— swagger ëª…ë ¹ì–´ ì¨ì£¼ì–´ì•¼ í•¨

```
// package.json

{
  "name": "swagger",
  "version": "1.0.0",
  "description": "",
  "main": "server.js",
  "scripts": {
    "test": "echo \"Error: no test specified\" && exit 1",
    "swagger": "node swagger.js",
    "start": "nodemon server.js"
  },
  "author": "",
  "license": "ISC",
  "dependencies": {
    "@aws-sdk/client-s3": "^3.310.0",
    "@aws-sdk/s3-request-presigner": "^3.310.0",
    "aws-sdk": "^2.1353.0",
    "cors": "^2.8.5",
    "dotenv": "^16.0.3",
    "express": "^4.18.2",
    "jsonwebtoken": "^9.0.0",
    "multer": "^1.4.5-lts.1",
    "mysql": "^2.18.1",
    "mysql2": "^3.2.0",
    "nodemailer": "^6.9.1",
    "nodemon": "^2.0.22",
    "pm2": "^5.3.0",
    "sharp": "^0.32.0"
  },
  "devDependencies": {
    "swagger-autogen": "^2.23.1",
    "swagger-jsdoc": "^6.2.8",
    "swagger-ui-express": "^4.6.2"
  }
}
```

```
npm run swagger
```

ì¨ ì£¼ê³  ë‚˜ì„œ ì´ ëª…ë ¹ì–´ í•´ì£¼ë©´ swagger-output.json íŒŒì¼ì´ ìƒì„±ë˜ë©´ì„œ keyê°’ ë“±ë“± ìë™ìœ¼ë¡œ ë§Œë“¤ì–´ì§

ë§Œì•½ scriptsì— prestartë¥¼ ì¨ì£¼ë©´ npm startí•˜ë©´ ìë™ìœ¼ë¡œ ë‹¤ì‹œ ìƒì„±ë¨

```
// package.json

{
  "name": "swagger",
  "version": "1.0.0",
  "description": "",
  "main": "server.js",
  "scripts": {
    "test": "echo \"Error: no test specified\" && exit 1",
    "prestart": "node ./swagger.js",
    "start": "nodemon server.js"
  },
  "author": "",

  ...

}
```

ì´ ìƒíƒœì¼ ë•ŒëŠ” ê·¸ëƒ¥ ì„œë²„ ë„ê³  ë‹¤ì‹œ npm start í•´ì£¼ë©´ swagger-outputì´ ìë™ìœ¼ë¡œ ë‹¤ì‹œ ìƒì„±ë¨

### swagger-outpu.json

```
// swagger-output.json

{
  "swagger": "2.0",
  "info": {
    "title": "swagger API",
    "description": "swagger API",
    "version": "1.0.0"
  },
  "host": "http://localhost:8080",
  "basePath": "/",
  "schemes": [
    "http"
  ],
  "securityDefinitions": {
    "bearerAuth": {
      "name": "Authorization",
      "in": "header",
      "type": "apiKey",
      "description": "JWT Authorization header"
    }
  },
  "paths": {
    "/": {
      "get": {
        "description": "",
        "parameters": [],
        "responses": {
          "200": {
            "description": "OK"
          }
        }
      }
    },
		"/test/testread": {
      "post": {
        "description": "",
        "parameters": [
          {
            "name": "page",
            "in": "query",
            "type": "string"
          },
          {
            "name": "body",
            "in": "body",
            "schema": {
              "type": "object",
              "properties": {
                "email": {
                  "example": "any"
                },
                "name": {
                  "example": "any"
                }
              }
            }
          }
        ],
        "responses": {
          "200": {
            "description": "OK"
          },
          "500": {
            "description": "Internal Server Error"
          }
        }
      }
    },

    ...

  }
}
```

ì´ëŸ°ì‹ìœ¼ë¡œ ìë™ìœ¼ë¡œ parameters ì•ˆì— name, in, type ë“± req.bodyë¡œ í•´ë†“ì€ ì• ë“¤ì´ ìƒê¹€

âœ… swagger-output.jsonì€ nodemonì²˜ëŸ¼ ì €ì¥ í›„ ìë™ìœ¼ë¡œ ì„œë²„ê°€ ì¬ì‹¤í–‰ ë˜ëŠ” ê²½ìš° ìŠ¤í¬ë¦½íŠ¸ê°€ ì‹¤í–‰ ë˜ì§€ ì•ŠìŒ. ì½”ë“œ ì™„ì„± í•˜ë©´ ì„œë²„ë¥¼ ì¢…ë£Œí•˜ê³  npm run swaggerë¥¼ í•´ì¤˜ì•¼ í•¨.

<aside>
ğŸ’¡ ë§Œì•½ì— swagger-output.jsonì— íŒŒë¼ë¯¸í„°ê°€ í•˜ë‚˜ë„ ì•ˆë“¤ì–´ì˜¤ë©´ controllì—ì„œ ì½”ë“œ ì ì„ ë•Œ async(req, res) ì´ ë¶€ë¶„ì´ ë„ì–´ì“°ê¸°ê°€ ì•ˆ ë˜ì–´ ìˆëŠ”ì§€ ë³¼ ê²ƒ. 
async (req, res) ì´ë ‡ê²Œ ë„ì–´ì“°ê¸°ê°€ ë˜ì–´ìˆì–´ì•¼ íŒŒë¼ë¯¸í„°ë¥¼ ì½ìŒ

</aside>

ì˜ˆì‹œ)

```
test : async (req, res) => {

    const con = await pool.getConnection();

    const { st_id } = req.body;

    try {

      const [row] = await con.query(
        `SELECT student
        FROM TB_SCHOOL
        WHERE st_id = ?
        `, [st_id]
      );

      return res.send(row)


    } catch(err){
      await res.status(500).send({
          message:
              err.message || "some error occured"
      })

    }finally{con.release();}
  },
```

### ğŸ“Œ ì°¸ê³  ë¸”ë¡œê·¸

<br>

[[NodeJS] Swagger ìë™ ìƒì„± ë¼ì´ë¸ŒëŸ¬ë¦¬ swagger-autogen](https://llshl.tistory.com/49)

[Node.js + Swagger, ì–´ë µì§€ ì•Šê²Œ ì‚¬ìš©í•˜ê¸°](https://gngsn.tistory.com/69)
