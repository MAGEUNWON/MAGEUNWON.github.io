---
layout: post
title: AWS3 - Lightsail DNS 설정
tags: [AWS, Lightsail]
categories:
  - AWS
date: 2023-02-07
---

## Lightsail DNS 설정하기

<br>
이제 서버에 연결은 완료 됐지만 IP 주소로 접속하는게 뭔가 아쉬우니까 도메인을 설정해 보기로 했음!

AWS는 Route 53이라는 DNS 등록 및 관리 서비스를 제공하고 있음. Route53으로 등록하려면 아마존을 통해 도메인을 구입해야 함.

이미 도메인이 있거나 국내 도메인 등록 업체를 통해 구입했다면 Lightsail에서 네트워킹의 DNS 영역을 통해 관리 할 수 있음.

즉 도메인 구입 및 갱신은 국내 업체에서 하고 DNS 레코드 관리는 Lightsail에서 하면 됨!

이렇게 운영하는 장점으로는 AWS의 DNS를 이용하기 때문에 해외 DNS와 쿼리 응답 속도가 빨라지게 됨. 웹서비스가 페이스북이나 인스타그램같은 SNS 연동이 잦은 경우 국내 DNS보다 이점을 갖게 됨!

나는 그냥 도메인 연결해보고 싶어서 하는 거지만 나중에 도움이 될 듯함! EC2는 방식이 또 다르다고 하니 다시 알아봐야 할 것 같다!

## 도메인 구매하기

<br>
가비아 등의 도메인 제공 사이트에서 도메인을 구매함! 가비아에서 할인 상품 있길래 여기서 구입함!

[가비아](https://www.gabia.com/?utm_source=google&utm_medium=cpc&utm_term=%25EA%25B0%2580%25EB%25B9%2584%25EC%2595%2584&utm_campaign=%25EA%25B0%2580%25EB%25B9%2584%25EC%2595%2584)

## DNS 설정

<br>
구매가 완료되면 사용하는 도메인의 DNS 레코드를 먼저 설정한다!

도메인 등록 업체에서 네임서버를 변경하게 되면 도메인에 등록된 네임서버는 AWS를 가리키는데 AWS에는 도메인 레코드 정보가 없기 때문에 접속이 되지 않기 때문~!

Lightsail 관리의 네트워킹 페이지에서 DNS 영역 생성을 클릭! →

DNS 레코드를 관리할 도메인 주소를 입력한 다음 ‘DNS 영역 생성‘ 버튼을 클릭! → 레코드 추가하기 → 레코드 타입과 하위 도메인, 도메인이 연결될 Lightsail 서버를 차례대로 선택한 후 확인 누르기! 레코드 타입은 A레코드(그냥 아무것도 선택한 안 한 상태가 A레코드 임), 하위 도메인에 @ 넣어 줬는데 이러면 주소 칠 때 www 안 쓰고 바로 도메인 주소 써야 이동 됨. www 입력하려면 @ 말고 www 쓰면 되는 것 같음! 그 옆 칸에 고정 ip 주소 등록되어 있는 것 적어주면 됨!

## 네임서버 등록

<br>
DNS 레코드 설정을 끝내면 레코드 아래에 이름 서버가 4개 나타남! 얘네를 도메인의 네임 서버로 수정해야 한다

얘는 다시 가비아로 가서 등록 할 것!

도메인 관리 → 도메인 정보 변경 → 네임서버 설정에서 1차, 2차 ~4차에 차례로 이름 서버를 적어주고 적용해 주면 됨!

이렇게 하면 도메인 연결 완료!

(근데 이렇게 해도 도메인 주소 치고 사이트에 들어가면 연결이 바로 되지 않는다 😭

계속 네임 서버 다시 연결해주고 DNS 지웠다 다시 설정하고 x (반복..) 이랬는데 가비아에 네임 서버 수정 밑에 설명 보면 네임 서버 등록에 1~2일 이상 소요 된다고 써있는 것을 발견!!!

일단 이것 때문인 것 같아서 그냥 기다렸는데 하루 기다리니까 연결 됐다 😂)

## 포트 번호 등록

<br>
내껀 여기서 끝내면 안되고 포트 번호까지 등록해 줘야 함! 기존에 3050포트에서 웹 서비스가 실행되고 있었고 이걸 Ligthsail이랑 연결할 굳이 :3050 안 붙여도 들어 갈 수 있도록 설정 해줬음! 근데 도메인은 3050이 전달된 IP 주소가 아니라 그냥 기존 인스턴스 IP 주소로 연결 되서 3050이 안 붙은 아파치 서버 메인 화면이 나오게 됨

얘까지 연결해주려면 모바엑스텀에 가서 명령어 써줘야 함!

```
sudo iptables -t nat -A PREROUTING -i eth0 -p tcp --dport 80 -j REDIRECT --to-port 3050
# 80포트로 들어오는 요청을 3050으로 넘겨주는 명령어

sudo iptables -t nat -L --line-numbers

```

이렇게 해주면 도메인 주소 치면 바로 프로젝트로 들어가진다~!

### 📌 참고 블로그

<br>
[라이트세일 도메인 연결 DNS 등록](https://extrememanual.net/28239)

[AWS Lightsail DNS 설정하기](https://velog.io/@fgprjs/4.-AWS-LightSail-DNS%EC%84%A4%EC%A0%95%ED%95%98%EA%B8%B0)
